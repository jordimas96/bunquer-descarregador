<header>
    <img class="logo" src="assets/logo-bunquer-transparent.png" alt="logo búnquer">
    <div class="titol-header text-center flex-grow-1" [style.opacity]="scrolled ? 1 : 0">Descarregador de capítols d'El&nbsp;búnquer</div>
</header>

<div class="content">

    <h1 class="titol-pagina">Descarregador de capítols d'El búnquer</h1>

    <section class="descarrega-bloc card mb-5">
        <h3 class="mb-4 ps-2">Descarrega'ls tots de cop:</h3>
        
        <div class="text-center mb-3">
            <button class="rs boto descarregar-en-grup boing" (click)="obrirModal()">
                <i class="fa-solid fa-list-check me-1"></i>
                Descàrrega en bloc
            </button>
        </div>
    </section>


    <section class="descarrega-individual card">
        <h3 class="mb-4 ps-2">Cerca i descarrega'ls d'un en un:</h3>

        <div class="buscador mb-4">
            <input [(ngModel)]="textBuscar" placeholder="Cerca..." (input)="actLlistaFiltrada()">
        </div>

        @if (!textBuscar) {
            <!-- Normal -->
            <div class="llista-capitols mt-5">
                @for (temporada of llistaPerTemporades; track $index) {
                    <section class="temporada" [class.obert]="desplegablesOberts[$index]">
                        <button class="rs h1 mb-0 mx-auto titol desplegable" (click)="desplegablesOberts[$index] = !desplegablesOberts[$index]">
                            @if (temporada[0].capitol) { Temporada {{ $index + 1 }} }
                            @else { Millors moments }
                            <i class="fa-solid fa-chevron-down"></i>
                        </button>

                        <table class="taula">
                            <tr class="header">
                                @if (!temporada[0].setmana) {
                                    <th>Cap.</th>
                                }
                                <th>Títol</th>
                                <th>Desc. / Escolta</th>
                            </tr>
                            @for (capitol of temporada; track capitol.title) {
                                
                                <tr class="fila">
                                    @if (!capitol.setmana) {
                                        <td class="capitol">
                                            @if (capitol.capitol) {
                                                <span class="num-capitol">{{ capitol.temporada }}x</span>{{ capitol.capitol }}
                                            }
                                        </td>
                                    }
                                    <td class="titol">{{ capitol.titolMostrar }}</td>
                                    <td>
                                        <div class="botons">
                                            <button class="descarregar boto boing" (click)="cs.descarregarCapitol(capitol)" title="Descarrega MP3"
                                                [disabled]="capitol.descarregant" [class.descarregat]="capitol.descarregat">
                                                @if (capitol.descarregat) {
                                                    <i class="fa-solid fa-check"></i>
                                                } @else if (capitol.descarregant) {
                                                    <p-progress-spinner strokeWidth="6" />
                                                } @else {
                                                    <i class="fa-solid fa-download"></i>
                                                }
                                            </button>
                                            <a class="escoltar boto boing" [href]="capitol.urlPagina" target="_blank" title="Ecolta a 3Cat">
                                                <i class="fa-solid fa-play"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </table>
                    </section>
                }
            </div>
        } @else {
            <!-- Buscant -->
            <div class="llista-capitols filtrada mt-5">
                @if (llistaFiltrada.length) {
                    <h4 class="text-center fst-italic">{{ textNumResultats }}</h4>
                    <table class="taula capitols mx-auto mb-0">
                        <tr class="header">
                            <th>Capítol</th>
                            <th>Títol</th>
                            <th>Desc. / Escolta</th>
                        </tr>
                        @for (capitol of llistaFiltrada; track capitol.title) {
                            <tr class="fila">
                                <td class="capitol">
                                    @if (capitol.capitol) {
                                        <span class="num-capitol">{{ capitol.temporada }}x</span>{{ capitol.capitol }}
                                    }
                                </td>
                                <td class="titol">{{ capitol.titolMostrar }}</td>
                                <td>
                                    <div class="botons">
                                        <button class="descarregar boto boing" (click)="cs.descarregarCapitol(capitol)" title="Descarrega MP3"
                                            [disabled]="capitol.descarregant" [class.descarregat]="capitol.descarregat">
                                            @if (capitol.descarregat) {
                                                <i class="fa-solid fa-check"></i>
                                            } @else if (capitol.descarregant) {
                                                <p-progress-spinner strokeWidth="6" />
                                            } @else {
                                                <i class="fa-solid fa-download"></i>
                                            }
                                        </button>
                                        <a class="escoltar boto boing" [href]="capitol.urlPagina" target="_blank" title="Ecolta a 3Cat">
                                            <i class="fa-solid fa-play"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </table>
                } @else {
                    <h3 class="text-center fst-italic">Cap resultat</h3>
                }
            </div>
        }

    </section>




    
</div>

<footer>
    <a class="firma boing" href="https://jordimas96.github.io/">
        <img class="logo" src="https://jordimas96.github.io/assets/icons/jmas/vermell.png" alt="logo jmas">
        <div class="text">Web desenvolupada per Jordi&nbsp;Mas</div>
    </a>
    <div class="legal">
        Aquest projecte no està afiliat ni autoritzat per 3Cat ni Catalunya Ràdio.<br>
        Aquesta web <b>NO</b> allotja cap arxiu.
        <a href="https://bunquer-descarregador.github.io/AVIS-LEGAL">Avís legal</a>
    </div>
</footer>
